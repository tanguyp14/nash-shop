{% schema %}
{
  "name": "TYLT - Countdown",
  "settings": [
    {
      "type": "text",
      "id": "date_picker",
      "label": "Date de mise de fin",
      "default": "12-24-2025 13:00",
      "info": "Mois Jour Année Heure:Minute"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Couleur de fond",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Couleur du texte",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "TYLT - Countdown"
    }
  ]
}
{% endschema %}

<section class="tylt_countdown">
  <div class="countdown">
    <div class="countdown__timer">
      <span class="countdown__days"></span>
      <span class="countdown__hours"></span>
      <span class="countdown__minutes"></span>
      <span class="countdown__seconds"></span>
    </div>
  </div>
</section>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Récupère la date depuis les settings Liquid
    var dateStr = '{{ section.settings.date_picker }}';
    // Format attendu: MM-DD-YYYY HH:mm
    var dateParts = dateStr.split(' ');
    var date = dateParts[0].split('-');
    var time = dateParts[1].split(':');
    // Crée un objet Date en UTC
    var countdownDate = new Date(
      date[2], // year
      date[0] - 1, // month (0-indexed)
      date[1], // day
      time[0], // hour
      time[1] // minute
    );

    function updateCountdown() {
      var now = new Date();
      var distance = countdownDate - now;

      var days = Math.floor(distance / (1000 * 60 * 60 * 24));
      var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      var seconds = Math.floor((distance % (1000 * 60)) / 1000);

      document.querySelector('.countdown__days').textContent = days + 'j';
      document.querySelector('.countdown__hours').textContent = hours + 'h';
      document.querySelector('.countdown__minutes').textContent = minutes + 'm';
      document.querySelector('.countdown__seconds').textContent = seconds + 's';

      if (distance < 0) {
        document.querySelector('.countdown__timer').textContent = 'Terminé';
        clearInterval(interval);
      }
    }

    updateCountdown();
    var interval = setInterval(updateCountdown, 1000);
  });
</script>

<style>
  .tylt_countdown .countdown {
    background-color: {{ section.settings.background_color }};
    color: {{ section.settings.text_color }};
  }
</style>
