{% schema %}
{
  "name": "Multi-Marquee",
  "settings": [
    {
      "type": "number",
      "id": "margin-top",
      "label": "Margin top (Negatif possible)",
      "default": 0
    },
    {
      "type": "number",
      "id": "height",
      "label": "Height en Vh",
      "default": 2
    }
  ],
  "blocks": [
    {
      "type": "text",
      "name": "Texte",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Texte à afficher",
          "default": "Message défilant"
        },
        {
          "type": "number",
          "id": "rotate",
          "label": "Rotation (Négatif possible)",
          "default": 0
        },
        {
          "type": "number",
          "id": "top",
          "label": "Position en vw (Négatif possible)",
          "default": 0
        },
        {
          "type": "number",
          "id": "typo_size",
          "label": "Taille de la TYPO(VH)",
          "default": 0
        },
        {
          "type": "text",
          "id": "typo_text",
          "label": "Typographie (Google font)",
          "default": "'Poppins', sans-serif",
        },
        {
          "type": "text",
          "id": "typo_text_transform",
          "label": "Text Transform",
          "default": "uppercase",
        },
        {
          "type": "color",
          "id": "color",
          "label": "Couleur du texte"
        },
        {
          "type": "text",
          "id": "font_style",
          "label": "Font Style"
        },
        {
          "type": "number",
          "id": "typo_text_weight",
          "label": "Weight de la TYPO",
          "default": 400
        },
        {
          "type": "color",
          "id": "bg_color",
          "label": "Couleur arrirère-plan"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Multi-Marquee"
    }
  ]
}
{% endschema %}

<section id="hats_multi_marquee" style="margin-top:{{ section.settings.margin-top }}vw; height: {{ section.settings.height }}vh">
  {% for block in section.blocks %}
      {% if block.settings.text != '' %}
        <div class="marquee_multi {{ section.id }}" style="rotate: {{ block.settings.rotate }}deg; top: {{ block.settings.top }}vw; background-color: {{ block.settings.bg_color }}; height: {{ block.settings.typo_size }}vh; font-size: {{ block.settings.typo_size | minus: 1.5 }}vh">
          <span class="text" style="color: {{ block.settings.color }}; font-style: {{ block.settings.font_style }};text-transform:{{ block.settings.typo_text_transform }}; font-family: {{ block.settings.typo_text }}; font-weight: {{ block.settings.typo_text_weight }};">
            &nbsp;{{ block.settings.text }}&nbsp;-&nbsp;{{ block.settings.text }}&nbsp;-&nbsp;
            {{- block.settings.text -}}&nbsp;-&nbsp;{{ block.settings.text }}&nbsp;-&nbsp;{{ block.settings.text }}&nbsp;-
          </span>
        </div>
      {% endif %}
  {% endfor %}
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    function Marquee(element, baseSpeed) {
      const clone = element.innerHTML;
      const firstElement = element.children[0];
      let i = 0;
      let speed = baseSpeed;
      let hovering = false;
      let acceleration = 0;
  
      element.insertAdjacentHTML('beforeend', clone);
  
      function animate() {
        firstElement.style.marginLeft = `-${i}px`;
        i += speed;
  
        if (i > firstElement.clientWidth) {
          i = 0;
        }
  
        if (hovering) {
          acceleration += 0.01; // augmente progressivement
          speed = baseSpeed + acceleration;
        } else {
          acceleration = Math.max(0, acceleration - 0.01); // redescend doucement
          speed = baseSpeed + acceleration;
        }
  
        requestAnimationFrame(animate);
      }
  
      element.addEventListener('mouseenter', () => {
        hovering = true;
      });
  
      element.addEventListener('mouseleave', () => {
        hovering = false;
      });
  
      animate();
    }
  
    const marquees = document.querySelectorAll('.marquee_multi.{{ section.id }}');
    marquees.forEach(function (marquee) {
      Marquee(marquee, 0.2);
    });
  });
  
</script>
